<?xml version = "1.0" encoding = "UTF-8"?>

<!--
 * build.xml
 * 
 *  This library is free software; you can redistribute it and/or
 *  modify it under the terms of the GNU Lesser General Public
 *  License as published by the Free Software Foundation; either
 *  version 2.1 of the License, or (at your option) any later version.
 *  
 *  This library is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 *  Lesser General Public License for more details.
 *
 *  You should have received a copy of the GNU Lesser General Public
 *  License along with this library; if not, write to the Free Software
 *  Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA
 *  
 *  A copy of the GNU Lesser General Public License may also be found at 
 *  http://www.gnu.org/licenses/lgpl.txt
 *
-->
<project name="utils.cpo" default="make" basedir="..">
      <target name="init">
            <property name="regex" value="${basedir}/lib/gnu-regexp-1.1.4.jar"/>
            <!--<condition property="weblogic" value="c:/bea/wlserver6.1">
                  <and>
                        <os family="windows"/>
                  </and>
            </condition>
            <condition property="weblogic" value="/opt/BEA/weblogic81/server">
                  <and>
                        <os family="unix"/>
                  </and>
            </condition>
            <property name="weblogic-jar" value="${weblogic}/lib/weblogic.jar"/>
                <property name="log4j-jar" value="${basedir}/lib/log4j.jar"/>-->
            <property name="libdir" value="${basedir}/lib"/>
            <!--:../../../../src/skinlf-1.2.3/lib/skinlf.jar"/>-->
            <property name="log4j-props" value="${basedir}/build/log4j.properties"/>
            <!--    <property name="aquathemepack" value="../../../../src/skinlf-1.2.3/lib/aquathemepack.zip"/>-->
            <property name="compiler.flag.debug" value="true"/>
            <property name="compiler.flag.deprecated" value="true"/>
            <property name="compiler.flag.optimize" value="true"/>
            <property name="buildir" value="${basedir}/bin"/>
            <property name="sourcedir" value="${basedir}/src"/>
            <property name="defaultprops" value="${sourcedir}/Default.properties"/>
            <property name="jnlpfile" value="${sourcedir}/cpoutil.jnlp"/>
            <property name="logo" value="${sourcedir}/sync-logo.gif"/>
            <property name="logo-sm" value="${sourcedir}/sync-logo-sm.gif"/>
            <property name="logo-sm-xpm" value="${sourcedir}/sync-logo-sm.xpm"/>
            <property name="logo-sm-ico" value="${sourcedir}/sync-logo-sm.ico"/>
            <property name="iconRed" value="${sourcedir}/red.gif"/>
            <property name="iconYellow" value="${sourcedir}/yellow.gif"/>
            <property name="iconGreen" value="${sourcedir}/green.gif"/>
      </target>

      <target name="compile" depends="init">
            <echo>Class path set: ${build.classpath}</echo>
            <echo>Compiler Options:</echo>
            <echo> Debug = ${compiler.flag.debug}</echo>
            <echo> Deprecation = ${compiler.flag.deprecated}</echo>
            <echo> Optimize = ${compiler.flag.optimize}</echo>
            <mkdir dir="${buildir}"/>
            <javac srcdir="${sourcedir}" destdir="${buildir}" debug="${compiler.flag.debug}"
                  deprecation="${compiler.flag.deprecated}" optimize="${compiler.flag.optimize}">
                  <classpath>
                        <fileset dir="${libdir}">
                              <exclude name="**/*.so"/>
                              <exclude name="**/*.dll"/>
                        </fileset>
                        <!--<pathelement path="${build.classpath}"/>
                        <pathelement path="${weblogic-jar}"/>-->
                  </classpath>
            </javac>
            <copy file="${defaultprops}" todir="${buildir}"/>
            <copy file="${logo}" todir="${buildir}"/>
            <copy file="${logo-sm}" todir="${buildir}"/>
            <copy file="${logo-sm-xpm}" todir="${buildir}"/>
            <copy file="${logo-sm-ico}" todir="${buildir}"/>
            <copy file="${iconRed}" todir="${buildir}"/>
            <copy file="${iconYellow}" todir="${buildir}"/>
            <copy file="${iconGreen}" todir="${buildir}"/>
            <copy file="${log4j-props}" todir="${buildir}"/>
      </target>

      <target name="make" depends="compile"  description="Build project">
            <jar jarfile="${buildir}/utilscpo.jar" basedir="${buildir}"
                  manifest="${sourcedir}/META-INF/MANIFEST.MF"
                  excludes="utilscpo.jar,weblogic.jar,platform-ejb.jar"/>
            <copy file="${jnlpfile}" todir="${buildir}"/>
            <copy file="${regex}" todir="${buildir}"/>
      </target>
      <target name="clean" depends="init">
            <delete dir="${buildir}"/>
      </target>
      <target name="run" depends="make" description="Run CPO Util">
        <java fork="true" classname="org.synchronoss.utils.cpo.CpoUtil">
          <classpath>
                <fileset dir="${libdir}">
                      <exclude name="**/*.so"/>
                      <exclude name="**/*.dll"/>
                </fileset>
            <fileset dir="${buildir}">
              <include name="utilscpo.jar"/>
            </fileset>
                <!--<pathelement path="${build.classpath}"/>
                <pathelement path="${weblogic-jar}"/>-->
          </classpath>
        </java>
      </target>
      <target name="remake" depends="clean,make" description="Rebuild entire project"/>
      <!--
      <target name="test-wlcon" depends="make" description="Test cursor leak">
            <junit printsummary="withOutAndErr" haltonfailure="false" showoutput="true" fork="yes">
                  <formatter type="xml"/>
                  <classpath>
                        <fileset dir="${libdir}"/>
                        <pathelement path="${buildir}/utilscpo.jar"/>
                        <pathelement path="${weblogic-jar}"/>
                  </classpath>
                  <test name="org.synchronoss.utils.cpo.junit.WebLogicConnPoolTest" todir="."/>
            </junit>
      </target>
      -->
</project>
